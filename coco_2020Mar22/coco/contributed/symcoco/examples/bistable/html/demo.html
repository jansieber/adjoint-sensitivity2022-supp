
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Use of symbolic derivatives  for coco demo bistable</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-03-01"><meta name="DC.source" content="demo.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Use of symbolic derivatives  for coco demo bistable</h1><!--introduction--><p>(see coco demo bistable). The right-hand side for the ODE (the Duffing oscillator) was generated in <a href="gen_sym_bistable.html">gen_sym_bistable.html</a></p><p><img src="demo_eq10796039726505834546.png" alt="$$&#xA;  \frac{\mathrm{d}}{\mathrm{d} t}\vec{x}=\vec{f}(t,\vec{x},\vec{p})&#xA;$$"></p><p>where</p><p><img src="demo_eq11826213949390484103.png" alt="$$&#xA; \vec{x}=&#xA;  \left[\begin{array}{c}&#xA;    x\\ v&#xA;  \end{array}\right],\quad&#xA;  \vec{p}=\left[&#xA;  \begin{array}{c}&#xA;    T\\ a\\ \gamma&#xA;  \end{array}\right],\quad&#xA;  \vec{f}=\left[&#xA;  \begin{array}{l}&#xA;    v\\ -\gamma v-x-x^3+a \cos(2 \pi t/T)&#xA;  \end{array}\right]&#xA;$$"></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Load path</a></li><li><a href="#2">Extract functions with sco_gen</a></li><li><a href="#3">Initial run with IVP solver</a></li><li><a href="#4">Demonstrate vectorized calls to function and derivatives</a></li><li><a href="#5">Second-order derivatives</a></li><li><a href="#6">Scalar arguments</a></li><li><a href="#7">Shortcut</a></li><li><a href="#8">Run of coco demo</a></li><li><a href="#9">Define r.h.s. and derivatives, and use IVP solution as initial guess</a></li><li><a href="#10">Define coco problem for initial response curve</a></li><li><a href="#11">Continue curve of saddle-node bifurcations</a></li><li><a href="#12">Sweep frequency-response curves</a></li><li><a href="#13">Free vibrations - backbone</a></li><li><a href="#14">Graphical representation of stored solutions</a></li><li><a href="#15">Remove path to symcoco</a></li></ul></div><h2 id="1">Load path</h2><pre class="codeinput">clear
addpath([pwd(),<span class="string">'/../../toolbox'</span>]); <span class="comment">% path of symcoco routines</span>
format <span class="string">compact</span>
</pre><h2 id="2">Extract functions with sco_gen</h2><p>After the function file <tt>sym_bistable.m</tt> has been generated, the symbolic toolbox is no longer needed. The function file is usually not directly called by the user. Instead, one uses the wrapper <tt>sco_gen</tt> to define the right-hand side and its partial derivatives.  The input format of the right-hand side was set by the 2nd and 3rd arguments of the call to <tt>sco_sym2funcs</tt>.</p><p>The first line calls <tt>sco_gen</tt> to extract the right-hand side <img src="demo_eq18096895394918367257.png" alt="$f$"> from <tt>sym_bistable</tt>. The empty-string second argument indicates that no partial derivatives are requested such that the returned function handle <tt>f</tt> is will return the values of <img src="demo_eq18096895394918367257.png" alt="$f$">. Partial derivatives of <img src="demo_eq18096895394918367257.png" alt="$f$"> with respect to its arguments are generated by giving the name of the argument of <img src="demo_eq18096895394918367257.png" alt="$f$"> with respect to which differentiation should occur as the second input. Line 2 demonstrates this, defining <img src="demo_eq02795664925824227649.png" alt="$\partial f_x(t,x,p)$">.</p><pre class="codeinput">f=sco_gen(@sym_bistable,<span class="string">''</span>);    <span class="comment">% define f: y=f(t,x,p)</span>
dfx=sco_gen(@sym_bistable,<span class="string">'x'</span>); <span class="comment">% define df/dx: J=df(t,x,p)</span>
</pre><h2 id="3">Initial run with IVP solver</h2><p>This section runs an initial-value problem ODE solver for the Duffing oscillator problem using <tt>ode45</tt>.  Line 2 and 3 call the standard Matlab function <tt>ode45</tt> to solve the ODE using the constructed <tt>f</tt> as its argument (with parameters <tt>p0</tt> as fixed in line 1).</p><pre class="codeinput">p0=[2*pi; 0.015; 0.04];         <span class="comment">% set initial parameter values</span>
[~,x0]=ode45(@(t,x)f(t,x,p0), [0 20*pi], [0;1]); <span class="comment">% Transients, starting at x=[0;1]</span>
[t0,x0]=ode45(@(t,x)f(t,x,p0), [0 2*pi], x0(end,:)'); <span class="comment">% Approximate periodic orbit</span>
</pre><h2 id="4">Demonstrate vectorized calls to function and derivatives</h2><p>The function <tt>f</tt> may be called with arguments <tt>t</tt> of shape <tt>1xN</tt>, <tt>x</tt> of shape <tt>2xN</tt>, <tt>p</tt> of shape <tt>3xN</tt>, returning, for example, in line 1, <tt>f_t</tt> of shape <tt>2xN</tt>, where <tt>N</tt> is an arbitrary number, permitting vectorized calls to <tt>f</tt>. Line 1 demonstrates this call by evaluating <tt>f</tt> along the solution obtained by the IVP solver (note the transposing of the inputs <tt>t0</tt> and <tt>x0</tt>).</p><p>Inputs format of <tt>dfx</tt> is the same as for <tt>f</tt>, but the output has format <tt>2x2xN</tt>, returning the <tt>2x2</tt> partial derivative <img src="demo_eq12414848264962041895.png" alt="$\partial_xf$"> in the arguments. Line 2 below demonstrates a vectorized call to <tt>dfx</tt> along the solution, where output <tt>df_t</tt> has shape <tt>[2,2,size(x0',2)]</tt>.</p><p>The plot shows the position, velocity, force and instantaneous spring stiffness, thus extracted.</p><pre class="codeinput">f_t=f(t0',x0',p0);              <span class="comment">% values of f(t,x(t),p) along orbit</span>
dfx_t=dfx(t0',x0',p0);           <span class="comment">% values of df/dx(t,x(t),p) along orbit</span>
fprintf(<span class="string">'size(f_t)=[%d,%d], '</span>,size(f_t));
fprintf(<span class="string">'size(dfx_t)=[%d,%d,%d]\n'</span>,size(dfx_t));
clf;plot(t0,x0(:,1),<span class="string">'DisplayName'</span>,<span class="string">'position'</span>);hold <span class="string">on</span>;legend;
plot(t0,x0(:,2),<span class="string">'DisplayName'</span>,<span class="string">'velocity'</span>);
plot(t0,f_t(2,:),<span class="string">'DisplayName'</span>,<span class="string">'force'</span>);
plot(t0,squeeze(dfx_t(2,1,:)),<span class="string">'DisplayName'</span>,<span class="string">'spring stiffness'</span>)
hold <span class="string">off</span>
xlabel(<span class="string">'time'</span>);
</pre><pre class="codeoutput">size(f_t)=[2,49], size(dfx_t)=[2,2,49]
</pre><img vspace="5" hspace="5" src="demo_01.png" alt=""> <h2 id="5">Second-order derivatives</h2><p>Second order partial derivatives are generated by giving a cell array with two names as the second argument of <tt>sco_gen</tt>. The input format of the resulting function is the same as for <tt>f</tt>, but, for example for <tt>dfxp</tt>$=\partial^2_{x,p}f(t,x,p)$, the output has shape <tt>2x2x3xN</tt>. In this example, only one of the mixed second derivatives is non-zero (equal <tt>-1</tt>): <img src="demo_eq03225959606906974361.png" alt="$\partial_{v,\gamma}f_2$">, corresponding to <tt>dfxp_t(2,2,3,:)</tt>.</p><pre class="codeinput">dfxp=sco_gen(@sym_bistable,{<span class="string">'x'</span>,<span class="string">'p'</span>});
dfxp_t=dfxp(t0',x0',p0);
fprintf(<span class="string">'size(dfxp_t)=[%d,%d,%d,%d]\n'</span>,size(dfxp_t));
df2_vgam=squeeze(dfxp_t(2,2,3,:)).' <span class="comment">%#ok&lt;*NOPTS&gt;</span>
</pre><pre class="codeoutput">size(dfxp_t)=[2,2,3,49]
df2_vgam =
  Columns 1 through 13
    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1
  Columns 14 through 26
    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1
  Columns 27 through 39
    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1
  Columns 40 through 49
    -1    -1    -1    -1    -1    -1    -1    -1    -1    -1
</pre><h2 id="6">Scalar arguments</h2><p>Outputs of derivatives with respect to inputs that were declared as scalar in the call to <tt>sco_sym2funcs</tt> have an output format of reduced shape. In this example, the 1st argument of <tt>f</tt>, <tt>'t'</tt>, is of this type. This exception accommodates conventions of the COLL toolbox.</p><pre class="codeinput">dft=sco_gen(@sym_bistable,<span class="string">'t'</span>);
dftt=sco_gen(@sym_bistable,{<span class="string">'t'</span>,<span class="string">'t'</span>});
dftp=sco_gen(@sym_bistable,{<span class="string">'t'</span>,<span class="string">'p'</span>});
dfxt=sco_gen(@sym_bistable,{<span class="string">'x'</span>,<span class="string">'t'</span>});
fprintf(<span class="string">'size(dft_t)=[%d,%d]\n'</span>,size(dft(t0',x0',p0)));
fprintf(<span class="string">'size(dftt_t)=[%d,%d]\n'</span>,size(dftt(t0',x0',p0)));
fprintf(<span class="string">'size(dfxt_t)=[%d,%d,%d]\n'</span>,size(dfxt(t0',x0',p0)));
</pre><pre class="codeoutput">size(dft_t)=[2,49]
size(dftt_t)=[2,49]
size(dfxt_t)=[2,2,49]
</pre><h2 id="7">Shortcut</h2><p>The call to <tt>sco_gen</tt> with only its first input is a shortcut for the creating the function in line 2 below. This shortcut makes the notation more succinct when a sequence of partial derivatives is passed on as an argument to coco constructors. For example, the cell array <tt>funcs</tt> collects <img src="demo_eq18096895394918367257.png" alt="$f$"> and its first partial derivatives wit hrespet to <tt>'x'</tt> and <tt>'p'</tt>. This cell array is the argument required for the coco demo <tt>bistable</tt>.</p><pre class="codeinput">F=sco_gen(@sym_bistable);                        <span class="comment">% F and F2 are the same</span>
F2=@(varargin)sco_gen(@sym_bistable,varargin{:});<span class="comment">% F and F2 are the same</span>
funcs = {F(<span class="string">''</span>),F(<span class="string">'x'</span>),F(<span class="string">'p'</span>)}; <span class="comment">%#ok&lt;NASGU&gt;</span>
</pre><h2 id="8">Run of coco demo</h2><p>Most of the above parts were only an illustration of using symboilc derivatives. The coco demo bistable only needs the outputs of the IVP solution and  the definition of the array <tt>funcs</tt>. Below is the remainder of the original coco demo bistable. At the beginning we repeat the commands needed from above.</p><h2 id="9">Define r.h.s. and derivatives, and use IVP solution as initial guess</h2><pre class="codeinput">clear
F=sco_gen(@sym_bistable);       <span class="comment">%shortcut for function generator</span>
funcs = {F(<span class="string">''</span>),F(<span class="string">'x'</span>),F(<span class="string">'p'</span>)};  <span class="comment">% r.h.s. and partial derivatives</span>
p0=[2*pi; 0.015; 0.04];         <span class="comment">% set initial parameter values</span>
[~,x0]=ode45(@(t,x)funcs{1}(t,x,p0),[0 20*pi],[0;1]); <span class="comment">% Transients, starting at x=[0;1]</span>
[t0,x0]=ode45(@(t,x)funcs{1}(t,x,p0),[0 2*pi],x0(end,:)'); <span class="comment">% Approximate periodic orbit</span>
</pre><h2 id="10">Define coco problem for initial response curve</h2><pre class="codeinput">prob = coco_prob();
prob = coco_set(prob, <span class="string">'ode'</span>, <span class="string">'autonomous'</span>, false);
coll_args = [funcs, {t0, x0, {<span class="string">'T'</span> <span class="string">'A'</span> <span class="string">'d'</span>}, p0}];
prob = ode_isol2po(prob, <span class="string">''</span>, coll_args{:});
[data, uidx] = coco_get_func_data(prob, <span class="string">'po.orb.coll'</span>, <span class="string">'data'</span>, <span class="string">'uidx'</span>);
maps = data.coll_seg.maps;
prob = coco_add_glue(prob, <span class="string">'glue'</span>, uidx(maps.T_idx), uidx(maps.p_idx(1)));
prob = po_mult_add(prob, <span class="string">'po.orb'</span>);  <span class="comment">% Store Floquet multipliers with bifurcation data</span>
cont_args = {1, {<span class="string">'po.period'</span> <span class="string">'T'</span>}, [2*pi/1.3 2*pi/0.7]};

fprintf(<span class="string">'\n Run=''%s'': Continue primary family of periodic orbits.\n'</span>, <span class="keyword">...</span>
  <span class="string">'freq_resp'</span>);

bd1  = coco(prob, <span class="string">'freq_resp'</span>, [], cont_args{:});
</pre><pre class="codeoutput">
 Run='freq_resp': Continue primary family of periodic orbits.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          8.85e-02  1.28e+01    0.0    0.0    0.0
   1   1  5.61e-01  8.26e-01  3.90e-02  1.27e+01    0.0    0.0    0.0
   2   1  6.48e-01  6.34e-01  1.42e-02  1.27e+01    0.0    0.0    0.0
   3   1  8.36e-01  4.51e-01  2.97e-03  1.27e+01    0.0    0.0    0.0
   4   1  1.00e+00  1.69e-01  2.29e-04  1.27e+01    0.0    0.0    0.0
   5   1  1.00e+00  8.89e-03  7.62e-07  1.27e+01    0.0    0.0    0.0
   6   1  1.00e+00  3.66e-05  1.16e-11  1.27e+01    0.0    0.0    0.0
   7   1  1.00e+00  4.81e-10  6.10e-16  1.27e+01    0.0    0.1    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2687e+01      1  EP      6.2832e+00   6.2832e+00
   10  00:00:00   1.2416e+01      2          6.0934e+00   6.0934e+00
   20  00:00:01   1.2281e+01      3          6.0017e+00   6.0017e+00
   27  00:00:02   1.2239e+01      4  SN      5.9882e+00   5.9882e+00
   27  00:00:02   1.2239e+01      5  FP      5.9882e+00   5.9882e+00
   30  00:00:02   1.2221e+01      6          5.9924e+00   5.9924e+00
   40  00:00:02   1.2170e+01      7          6.0183e+00   6.0183e+00
   42  00:00:03   1.2159e+01      8  SN      6.0189e+00   6.0189e+00
   42  00:00:03   1.2159e+01      9  FP      6.0189e+00   6.0189e+00
   50  00:00:03   1.1955e+01     10          5.9558e+00   5.9558e+00
   60  00:00:04   1.1383e+01     11          5.6860e+00   5.6860e+00
   67  00:00:05   9.6681e+00     12  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:05   1.2687e+01     13  EP      6.2832e+00   6.2832e+00
   10  00:00:05   1.3265e+01     14          6.6177e+00   6.6177e+00
   20  00:00:06   1.5284e+01     15          7.6405e+00   7.6405e+00
   26  00:00:06   1.7953e+01     16  EP      8.9760e+00   8.9760e+00
</pre><h2 id="11">Continue curve of saddle-node bifurcations</h2><p>After imposition of gluing conditions, the continuation problem encoded below has a dimensional deficit of -2. A one-dimensional family of saddle-node bifurcations of periodic orbits is obtained by releasing 'po.period', 'T', and 'A', and allowing these to vary during continuation.</p><pre class="codeinput">labs = coco_bd_labs(bd1, <span class="string">'SN'</span>);

prob = coco_prob();
prob = coco_set(prob, <span class="string">'coll'</span>, <span class="string">'NTST'</span>, 25);
prob = ode_SN2SN(prob, <span class="string">''</span>, <span class="string">'freq_resp'</span>, labs(1));
[data, uidx] = coco_get_func_data(prob, <span class="string">'po.orb.coll'</span>, <span class="string">'data'</span>, <span class="string">'uidx'</span>);
maps = data.coll_seg.maps;
prob = coco_add_glue(prob, <span class="string">'glue'</span>, uidx(maps.T_idx), uidx(maps.p_idx(1)));
prob = coco_set(prob, <span class="string">'cont'</span>, <span class="string">'NAdapt'</span>, 5);
prob = coco_add_event(prob, <span class="string">'UZ'</span>, <span class="string">'A'</span>, 0.01:0.005:0.1);
cont_args = {1, {<span class="string">'po.period'</span> <span class="string">'T'</span> <span class="string">'A'</span>}, [2*pi/1.3 2*pi/0.7]};

fprintf(<span class="keyword">...</span>
  <span class="string">'\n Run=''%s'': Continue saddle-node bifurcations from point %d in run ''%s''.\n'</span>, <span class="keyword">...</span>
  <span class="string">'saddle-node'</span>, labs(1), <span class="string">'freq_resp'</span>);

bd2  = coco(prob, <span class="string">'saddle-node'</span>, [], cont_args{:});
</pre><pre class="codeoutput">
 Run='saddle-node': Continue saddle-node bifurcations from point 8 in run 'freq_resp'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          1.91e-02  1.65e+01    0.0    0.0    0.0
   1   1  1.00e+00  1.10e-02  1.04e-06  1.65e+01    0.0    0.0    0.0
   2   1  1.00e+00  1.52e-04  1.74e-10  1.65e+01    0.0    0.1    0.0
   3   1  1.00e+00  2.87e-09  4.18e-15  1.65e+01    0.0    0.1    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T            A
    0  00:00:00   1.6502e+01      1  EP      6.0189e+00   6.0189e+00   1.5000e-02
    1  00:00:00   1.6502e+01      2  UZ      6.0189e+00   6.0189e+00   1.5000e-02
    9  00:00:01   1.6230e+01      3  UZ      5.9506e+00   5.9506e+00   2.0000e-02
   10  00:00:01   1.6219e+01      4          5.9339e+00   5.9339e+00   2.1372e-02
   13  00:00:02   1.6044e+01      5  UZ      5.8927e+00   5.8927e+00   2.5000e-02
   15  00:00:02   1.6036e+01      6  UZ      5.8412e+00   5.8412e+00   3.0000e-02
   17  00:00:02   1.5869e+01      7  UZ      5.7944e+00   5.7944e+00   3.5000e-02
   19  00:00:03   1.5871e+01      8  UZ      5.7511e+00   5.7511e+00   4.0000e-02
   20  00:00:03   1.5875e+01      9  UZ      5.7108e+00   5.7108e+00   4.5000e-02
   20  00:00:03   1.5880e+01     10          5.6814e+00   5.6814e+00   4.8843e-02
   21  00:00:03   1.5703e+01     11  UZ      5.6728e+00   5.6728e+00   5.0000e-02
   21  00:00:03   1.5708e+01     12  UZ      5.6370e+00   5.6370e+00   5.5000e-02
   22  00:00:04   1.5714e+01     13  UZ      5.6029e+00   5.6029e+00   6.0000e-02
   23  00:00:04   1.5721e+01     14  UZ      5.5705e+00   5.5705e+00   6.5000e-02
   23  00:00:04   1.5729e+01     15  UZ      5.5394e+00   5.5394e+00   7.0000e-02
   24  00:00:04   1.5738e+01     16  UZ      5.5096e+00   5.5096e+00   7.5000e-02
   24  00:00:04   1.5748e+01     17  UZ      5.4810e+00   5.4810e+00   8.0000e-02
   25  00:00:05   1.5758e+01     18  UZ      5.4534e+00   5.4534e+00   8.5000e-02
   25  00:00:05   1.5768e+01     19  UZ      5.4268e+00   5.4268e+00   9.0000e-02
   25  00:00:05   1.5780e+01     20  UZ      5.4010e+00   5.4010e+00   9.5000e-02
   26  00:00:05   1.5579e+01     21  UZ      5.3761e+00   5.3761e+00   1.0000e-01
   30  00:00:06   1.5876e+01     22          4.9561e+00   4.9561e+00   2.1139e-01
   32  00:00:06   1.5752e+01     23  EP      4.8332e+00   4.8332e+00   2.5565e-01

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T            A
    0  00:00:06   1.6502e+01     24  EP      6.0189e+00   6.0189e+00   1.5000e-02
   10  00:00:07   1.6487e+01     25          6.0600e+00   6.0600e+00   1.2535e-02
   16  00:00:08   1.6292e+01     26  FP      6.0695e+00   6.0695e+00   1.2051e-02
   20  00:00:09   1.6376e+01     27          6.0639e+00   6.0639e+00   1.2292e-02
   29  00:00:10   1.6221e+01     28  UZ      5.9882e+00   5.9882e+00   1.5000e-02
   30  00:00:10   1.6284e+01     29          5.9457e+00   5.9457e+00   1.6350e-02
   34  00:00:11   1.6275e+01     30  UZ      5.8219e+00   5.8219e+00   2.0000e-02
   37  00:00:11   1.6330e+01     31  UZ      5.6424e+00   5.6424e+00   2.5000e-02
   40  00:00:11   1.6663e+01     32  UZ      5.4622e+00   5.4622e+00   3.0000e-02
   40  00:00:11   1.6748e+01     33          5.4221e+00   5.4221e+00   3.1129e-02
   42  00:00:12   1.7042e+01     34  UZ      5.2875e+00   5.2875e+00   3.5000e-02
   45  00:00:12   1.7499e+01     35  UZ      5.1217e+00   5.1217e+00   3.9999e-02
   47  00:00:13   1.7997e+01     36  UZ      4.9657e+00   4.9657e+00   4.5000e-02
   49  00:00:13   1.8498e+01     37  EP      4.8332e+00   4.8332e+00   4.9531e-02
</pre><h2 id="12">Sweep frequency-response curves</h2><p>For each of a sample of points on the curve of saddle-node bifurcations, the continuation problem encoded below has dimensional deficit -1.  A one-dimensional family of periodic orbits is obtained by releasing 'po.period' and 'T', and allowing these to vary during continuation.</p><pre class="codeinput">labs  = coco_bd_labs(bd2, <span class="string">'UZ'</span>);

<span class="keyword">for</span> lab=labs
  prob = coco_prob();
  prob = coco_set(prob, <span class="string">'ode'</span>, <span class="string">'autonomous'</span>, false);
  prob = coco_set(prob, <span class="string">'po'</span>, <span class="string">'bifus'</span>, <span class="string">'off'</span>);
  prob = ode_po2po(prob, <span class="string">''</span>, <span class="string">'saddle-node'</span>, lab);
  [data, uidx] = coco_get_func_data(prob, <span class="string">'po.orb.coll'</span>, <span class="string">'data'</span>, <span class="string">'uidx'</span>);
  maps = data.coll_seg.maps;
  prob = coco_add_glue(prob, <span class="string">'glue'</span>, uidx(maps.T_idx), uidx(maps.p_idx(1)));
  prob = coco_set(prob, <span class="string">'cont'</span>, <span class="string">'NAdapt'</span>, 10);
  cont_args = {1, {<span class="string">'po.period'</span> <span class="string">'T'</span>}, [2*pi/1.3 2*pi/0.7]};

  fprintf(<span class="keyword">...</span>
  <span class="string">'\n Run=''%s'': Continue family of periodic orbits from point %d in run ''%s''.\n'</span>, <span class="keyword">...</span>
  sprintf(<span class="string">'lab=%d'</span>, lab), lab, <span class="string">'saddle-node'</span>);

  coco(prob, sprintf(<span class="string">'lab=%d'</span>, lab), [], cont_args{:});
<span class="keyword">end</span>
</pre><pre class="codeoutput">
 Run='lab=21': Continue family of periodic orbits from point 21 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          5.37e-15  1.16e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1619e+01      1  EP      5.3761e+00   5.3761e+00
   10  00:00:00   1.0201e+01      2          4.9996e+00   4.9996e+00
   13  00:00:00   9.8108e+00      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1619e+01      4  EP      5.3761e+00   5.3761e+00
    1  00:00:01   1.1619e+01      5  FP      5.3761e+00   5.3761e+00
   10  00:00:01   1.3089e+01      6          5.0610e+00   5.0610e+00
   15  00:00:01   1.4008e+01      7  EP      4.8332e+00   4.8332e+00

 Run='lab=20': Continue family of periodic orbits from point 20 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.98e-15  1.17e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1677e+01      1  EP      5.4010e+00   5.4010e+00
   10  00:00:00   1.0249e+01      2          5.0239e+00   5.0239e+00
   13  00:00:00   9.8029e+00      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1677e+01      4  EP      5.4010e+00   5.4010e+00
    1  00:00:01   1.1677e+01      5  FP      5.4010e+00   5.4010e+00
   10  00:00:01   1.3159e+01      6          5.0945e+00   5.0945e+00
   16  00:00:02   1.4235e+01      7  EP      4.8332e+00   4.8332e+00

 Run='lab=19': Continue family of periodic orbits from point 19 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.41e-15  1.17e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1692e+01      1  EP      5.4268e+00   5.4268e+00
    1  00:00:00   1.1692e+01      2  FP      5.4268e+00   5.4268e+00
   10  00:00:00   1.0305e+01      3          5.0567e+00   5.0567e+00
   13  00:00:00   9.7885e+00      4  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1692e+01      5  EP      5.4268e+00   5.4268e+00
   10  00:00:01   1.3130e+01      6          5.1180e+00   5.1180e+00
   16  00:00:02   1.4280e+01      7  EP      4.8332e+00   4.8332e+00

 Run='lab=18': Continue family of periodic orbits from point 18 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          6.12e-15  1.17e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1708e+01      1  EP      5.4534e+00   5.4534e+00
   10  00:00:00   1.0363e+01      2          5.0906e+00   5.0906e+00
   14  00:00:00   9.7749e+00      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1708e+01      4  EP      5.4534e+00   5.4534e+00
    1  00:00:01   1.1708e+01      5  FP      5.4534e+00   5.4534e+00
   10  00:00:01   1.3100e+01      6          5.1426e+00   5.1426e+00
   16  00:00:02   1.4326e+01      7  EP      4.8332e+00   4.8332e+00

 Run='lab=17': Continue family of periodic orbits from point 17 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.79e-15  1.17e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1725e+01      1  EP      5.4810e+00   5.4810e+00
   10  00:00:00   1.0424e+01      2          5.1259e+00   5.1259e+00
   14  00:00:00   9.7622e+00      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1725e+01      4  EP      5.4810e+00   5.4810e+00
    1  00:00:01   1.1725e+01      5  FP      5.4810e+00   5.4810e+00
   10  00:00:01   1.3070e+01      6          5.1685e+00   5.1685e+00
   17  00:00:02   1.4373e+01      7  EP      4.8332e+00   4.8332e+00

 Run='lab=16': Continue family of periodic orbits from point 16 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.31e-15  1.17e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1745e+01      1  EP      5.5096e+00   5.5096e+00
   10  00:00:00   1.3037e+01      2          5.1964e+00   5.1964e+00
   18  00:00:01   1.4423e+01      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1745e+01      4  EP      5.5096e+00   5.5096e+00
    1  00:00:01   1.1745e+01      5  FP      5.5096e+00   5.5096e+00
   10  00:00:01   1.0487e+01      6          5.1625e+00   5.1625e+00
   15  00:00:02   9.7504e+00      7  EP      4.8332e+00   4.8332e+00

 Run='lab=15': Continue family of periodic orbits from point 15 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.18e-15  1.18e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1766e+01      1  EP      5.5394e+00   5.5394e+00
   10  00:00:00   1.0554e+01      2          5.2007e+00   5.2007e+00
   15  00:00:01   9.7393e+00      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1766e+01      4  EP      5.5394e+00   5.5394e+00
    1  00:00:01   1.1766e+01      5  FP      5.5394e+00   5.5394e+00
   10  00:00:01   1.3000e+01      6          5.2273e+00   5.2273e+00
   18  00:00:02   1.4282e+01      7  EP      4.8332e+00   4.8332e+00

 Run='lab=14': Continue family of periodic orbits from point 14 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.78e-15  1.18e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1790e+01      1  EP      5.5705e+00   5.5705e+00
    1  00:00:00   1.1790e+01      2  FP      5.5705e+00   5.5705e+00
   10  00:00:00   1.2961e+01      3          5.2607e+00   5.2607e+00
   19  00:00:01   1.4335e+01      4  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1790e+01      5  EP      5.5705e+00   5.5705e+00
   10  00:00:01   1.0624e+01      6          5.2407e+00   5.2407e+00
   15  00:00:02   9.7291e+00      7  EP      4.8332e+00   4.8332e+00

 Run='lab=13': Continue family of periodic orbits from point 13 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.12e-15  1.18e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1817e+01      1  EP      5.6029e+00   5.6029e+00
    1  00:00:00   1.1817e+01      2  FP      5.6029e+00   5.6029e+00
   10  00:00:00   1.2914e+01      3          5.2989e+00   5.2989e+00
   20  00:00:01   1.4357e+01      4          4.8417e+00   4.8417e+00
   21  00:00:01   1.4968e+01      5  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1817e+01      6  EP      5.6029e+00   5.6029e+00
   10  00:00:02   1.0700e+01      7          5.2833e+00   5.2833e+00
   16  00:00:02   9.7197e+00      8  EP      4.8332e+00   4.8332e+00

 Run='lab=12': Continue family of periodic orbits from point 12 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.63e-15  1.18e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1846e+01      1  EP      5.6370e+00   5.6370e+00
   10  00:00:00   1.0785e+01      2          5.3304e+00   5.3304e+00
   17  00:00:01   9.7111e+00      3  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1846e+01      4  EP      5.6370e+00   5.6370e+00
    1  00:00:01   1.1846e+01      5  FP      5.6370e+00   5.6370e+00
   10  00:00:01   1.2847e+01      6          5.3475e+00   5.3475e+00
   20  00:00:02   1.4120e+01      7          4.9137e+00   4.9137e+00
   23  00:00:02   1.5049e+01      8  EP      4.8332e+00   4.8332e+00

 Run='lab=11': Continue family of periodic orbits from point 11 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          5.50e-15  1.19e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1878e+01      1  EP      5.6728e+00   5.6728e+00
    1  00:00:00   1.1878e+01      2  FP      5.6728e+00   5.6728e+00
   10  00:00:00   1.0876e+01      3          5.3804e+00   5.3804e+00
   17  00:00:01   9.7033e+00      4  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1878e+01      5  EP      5.6728e+00   5.6728e+00
   10  00:00:01   1.2757e+01      6          5.4099e+00   5.4099e+00
   20  00:00:02   1.3796e+01      7          5.0172e+00   5.0172e+00
   30  00:00:03   1.4580e+01      8  EP      4.8332e+00   4.8332e+00

 Run='lab=9': Continue family of periodic orbits from point 9 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.70e-15  1.19e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1938e+01      1  EP      5.7108e+00   5.7108e+00
    1  00:00:00   1.1938e+01      2  FP      5.7108e+00   5.7108e+00
   10  00:00:00   1.2750e+01      3          5.4768e+00   5.4768e+00
   20  00:00:01   1.3637e+01      4          5.1289e+00   5.1289e+00
   30  00:00:02   1.4970e+01      5          4.9701e+00   4.9701e+00
   32  00:00:02   1.5008e+01      6  FP      4.9657e+00   4.9657e+00
   40  00:00:02   1.4812e+01      7          5.0482e+00   5.0482e+00
   50  00:00:03   1.3917e+01      8          5.3871e+00   5.3871e+00
   60  00:00:03   1.3226e+01      9          6.0242e+00   6.0242e+00
   70  00:00:04   1.4336e+01     10          7.1044e+00   7.1044e+00
   80  00:00:05   1.7970e+01     11  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:05   1.1938e+01     12  EP      5.7108e+00   5.7108e+00
   10  00:00:05   1.0966e+01     13          5.4283e+00   5.4283e+00
   18  00:00:06   9.6978e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=8': Continue family of periodic orbits from point 8 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.42e-15  1.20e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.1976e+01      1  EP      5.7511e+00   5.7511e+00
    1  00:00:00   1.1976e+01      2  FP      5.7511e+00   5.7511e+00
   10  00:00:00   1.1074e+01      3          5.4866e+00   5.4866e+00
   18  00:00:01   9.6912e+00      4  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:01   1.1976e+01      5  EP      5.7511e+00   5.7511e+00
   10  00:00:01   1.2662e+01      6          5.5492e+00   5.5492e+00
   20  00:00:02   1.3343e+01      7          5.2497e+00   5.2497e+00
   30  00:00:03   1.3818e+01      8          5.1224e+00   5.1224e+00
   31  00:00:03   1.4404e+01      9  FP      5.1217e+00   5.1217e+00
   40  00:00:03   1.4221e+01     10          5.2205e+00   5.2205e+00
   50  00:00:04   1.3534e+01     11          5.5642e+00   5.5642e+00
   60  00:00:05   1.3178e+01     12          6.1833e+00   6.1833e+00
   70  00:00:05   1.4470e+01     13          7.1896e+00   7.1896e+00
   80  00:00:06   1.7967e+01     14  EP      8.9760e+00   8.9760e+00

 Run='lab=7': Continue family of periodic orbits from point 7 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.62e-15  1.20e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2020e+01      1  EP      5.7944e+00   5.7944e+00
   10  00:00:00   1.2587e+01      2          5.6259e+00   5.6259e+00
   20  00:00:01   1.3085e+01      3          5.3792e+00   5.3792e+00
   30  00:00:02   1.3404e+01      4  FP      5.2875e+00   5.2875e+00
   30  00:00:02   1.3410e+01      5          5.2878e+00   5.2878e+00
   40  00:00:02   1.3716e+01      6          5.4057e+00   5.4057e+00
   50  00:00:03   1.3244e+01      7          5.7486e+00   5.7486e+00
   60  00:00:04   1.3180e+01      8          6.3448e+00   6.3448e+00
   70  00:00:04   1.4632e+01      9          7.2870e+00   7.2870e+00
   78  00:00:05   1.7963e+01     10  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:05   1.2020e+01     11  EP      5.7944e+00   5.7944e+00
    1  00:00:05   1.2020e+01     12  FP      5.7944e+00   5.7944e+00
   10  00:00:05   1.1193e+01     13          5.5503e+00   5.5503e+00
   19  00:00:06   9.6854e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=6': Continue family of periodic orbits from point 6 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.74e-15  1.21e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2088e+01      1  EP      5.8412e+00   5.8412e+00
    1  00:00:00   1.2088e+01      2  FP      5.8412e+00   5.8412e+00
   10  00:00:00   1.2575e+01      3          5.7076e+00   5.7076e+00
   20  00:00:01   1.2949e+01      4          5.5181e+00   5.5181e+00
   28  00:00:01   1.3151e+01      5  FP      5.4622e+00   5.4622e+00
   30  00:00:02   1.3171e+01      6          5.4662e+00   5.4662e+00
   40  00:00:02   1.3077e+01      7          5.6047e+00   5.6047e+00
   50  00:00:03   1.2916e+01      8          5.9406e+00   5.9406e+00
   60  00:00:04   1.3265e+01      9          6.5150e+00   6.5150e+00
   70  00:00:04   1.4909e+01     10          7.4395e+00   7.4395e+00
   77  00:00:05   1.7959e+01     11  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:05   1.2088e+01     12  EP      5.8412e+00   5.8412e+00
   10  00:00:05   1.1323e+01     13          5.6179e+00   5.6179e+00
   20  00:00:06   9.6810e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=5': Continue family of periodic orbits from point 5 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.33e-15  1.21e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2146e+01      1  EP      5.8927e+00   5.8927e+00
    1  00:00:00   1.2146e+01      2  FP      5.8927e+00   5.8927e+00
   10  00:00:00   1.2523e+01      3          5.7948e+00   5.7948e+00
   20  00:00:01   1.2767e+01      4          5.6663e+00   5.6663e+00
   26  00:00:01   1.2867e+01      5  FP      5.6424e+00   5.6424e+00
   30  00:00:02   1.2901e+01      6          5.6574e+00   5.6574e+00
   40  00:00:02   1.2809e+01      7          5.8116e+00   5.8116e+00
   50  00:00:03   1.2852e+01      8          6.1300e+00   6.1300e+00
   60  00:00:03   1.3470e+01      9          6.6783e+00   6.6783e+00
   70  00:00:04   1.5457e+01     10          7.7215e+00   7.7215e+00
   76  00:00:04   1.7957e+01     11  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:05   1.2146e+01     12  EP      5.8927e+00   5.8927e+00
   10  00:00:05   1.1478e+01     13          5.6996e+00   5.6996e+00
   20  00:00:06   9.9790e+00     14          4.9830e+00   4.9830e+00
   21  00:00:06   9.6761e+00     15  EP      4.8332e+00   4.8332e+00

 Run='lab=3': Continue family of periodic orbits from point 3 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          3.52e-15  1.22e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2230e+01      1  EP      5.9506e+00   5.9506e+00
   10  00:00:00   1.2524e+01      2          5.8895e+00   5.8895e+00
   20  00:00:01   1.2688e+01      3          5.8245e+00   5.8245e+00
   23  00:00:01   1.2669e+01      4  FP      5.8219e+00   5.8219e+00
   30  00:00:02   1.2729e+01      5          5.8601e+00   5.8601e+00
   40  00:00:02   1.2765e+01      6          6.0245e+00   6.0245e+00
   50  00:00:03   1.2928e+01      7          6.3213e+00   6.3213e+00
   60  00:00:03   1.3732e+01      8          6.8417e+00   6.8417e+00
   70  00:00:04   1.6660e+01      9          8.3273e+00   8.3273e+00
   73  00:00:04   1.7955e+01     10  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:04   1.2230e+01     11  EP      5.9506e+00   5.9506e+00
    1  00:00:04   1.2230e+01     12  FP      5.9506e+00   5.9506e+00
   10  00:00:05   1.1668e+01     13          5.7957e+00   5.7957e+00
   20  00:00:06   1.0500e+01     14          5.2430e+00   5.2430e+00
   23  00:00:06   9.6730e+00     15  EP      4.8332e+00   4.8332e+00

 Run='lab=2': Continue family of periodic orbits from point 2 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          2.35e-15  1.23e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2338e+01      1  EP      6.0189e+00   6.0189e+00
   10  00:00:00   1.2543e+01      2          5.9960e+00   5.9960e+00
   16  00:00:01   1.2594e+01      3  FP      5.9882e+00   5.9882e+00
   20  00:00:01   1.2644e+01      4          5.9960e+00   5.9960e+00
   30  00:00:02   1.2696e+01      5          6.0746e+00   6.0746e+00
   40  00:00:02   1.2796e+01      6          6.2456e+00   6.2456e+00
   50  00:00:03   1.3183e+01      7          6.5509e+00   6.5509e+00
   60  00:00:03   1.4313e+01      8          7.1499e+00   7.1499e+00
   69  00:00:04   1.7954e+01      9  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:04   1.2338e+01     10  EP      6.0189e+00   6.0189e+00
    1  00:00:04   1.2338e+01     11  FP      6.0189e+00   6.0189e+00
   10  00:00:05   1.1942e+01     12          5.9276e+00   5.9276e+00
   20  00:00:05   1.1153e+01     13          5.5674e+00   5.5674e+00
   26  00:00:06   9.6703e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=28': Continue family of periodic orbits from point 28 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          5.70e-15  1.25e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2493e+01      1  EP      5.9882e+00   5.9882e+00
   10  00:00:00   1.2373e+01      2          6.0088e+00   6.0088e+00
   16  00:00:01   1.2266e+01      3  FP      6.0189e+00   6.0189e+00
   20  00:00:01   1.2141e+01      4          6.0022e+00   6.0022e+00
   30  00:00:02   1.1632e+01      5          5.8004e+00   5.8004e+00
   40  00:00:02   9.9358e+00      6          4.9661e+00   4.9661e+00
   41  00:00:02   9.6692e+00      7  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:02   1.2493e+01      8  EP      5.9882e+00   5.9882e+00
    1  00:00:02   1.2493e+01      9  FP      5.9882e+00   5.9882e+00
   10  00:00:03   1.2581e+01     10          6.0237e+00   6.0237e+00
   20  00:00:04   1.2663e+01     11          6.1475e+00   6.1475e+00
   30  00:00:04   1.2895e+01     12          6.3725e+00   6.3725e+00
   40  00:00:05   1.3598e+01     13          6.7852e+00   6.7852e+00
   50  00:00:05   1.6547e+01     14          8.2722e+00   8.2722e+00
   53  00:00:06   1.7953e+01     15  EP      8.9760e+00   8.9760e+00

 Run='lab=30': Continue family of periodic orbits from point 30 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          6.50e-15  1.25e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2535e+01      1  EP      5.8219e+00   5.8219e+00
   10  00:00:00   1.2414e+01      2          5.8661e+00   5.8661e+00
   20  00:00:01   1.2220e+01      3          5.9460e+00   5.9460e+00
   23  00:00:01   1.2162e+01      4  FP      5.9506e+00   5.9506e+00
   30  00:00:01   1.1775e+01      5          5.8473e+00   5.8473e+00
   40  00:00:02   1.0850e+01      6          5.4168e+00   5.4168e+00
   44  00:00:02   9.6715e+00      7  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:03   1.2535e+01      8  EP      5.8219e+00   5.8219e+00
    1  00:00:03   1.2535e+01      9  FP      5.8219e+00   5.8219e+00
   10  00:00:03   1.2606e+01     10          5.8774e+00   5.8774e+00
   20  00:00:04   1.2689e+01     11          6.0620e+00   6.0620e+00
   30  00:00:04   1.2976e+01     12          6.3849e+00   6.3849e+00
   40  00:00:05   1.3924e+01     13          6.9451e+00   6.9451e+00
   50  00:00:06   1.7531e+01     14          8.7639e+00   8.7639e+00
   51  00:00:06   1.7955e+01     15  EP      8.9760e+00   8.9760e+00

 Run='lab=31': Continue family of periodic orbits from point 31 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          4.46e-15  1.26e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2592e+01      1  EP      5.6424e+00   5.6424e+00
    1  00:00:00   1.2592e+01      2  FP      5.6424e+00   5.6424e+00
   10  00:00:00   1.2639e+01      3          5.7114e+00   5.7114e+00
   20  00:00:01   1.2675e+01      4          5.9457e+00   5.9457e+00
   30  00:00:01   1.2978e+01      5          6.3548e+00   6.3548e+00
   40  00:00:02   1.4111e+01      6          7.0371e+00   7.0371e+00
   50  00:00:03   1.7956e+01      7  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:03   1.2592e+01      8  EP      5.6424e+00   5.6424e+00
   10  00:00:03   1.2456e+01      9          5.7025e+00   5.7025e+00
   20  00:00:04   1.2242e+01     10          5.8475e+00   5.8475e+00
   26  00:00:04   1.2067e+01     11  FP      5.8927e+00   5.8927e+00
   30  00:00:05   1.1838e+01     12          5.8489e+00   5.8489e+00
   40  00:00:05   1.1020e+01     13          5.4952e+00   5.4952e+00
   46  00:00:06   9.6738e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=32': Continue family of periodic orbits from point 32 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          8.73e-15  1.28e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.2770e+01      1  EP      5.4622e+00   5.4622e+00
    1  00:00:00   1.2770e+01      2  FP      5.4622e+00   5.4622e+00
   10  00:00:00   1.2781e+01      3          5.5410e+00   5.5410e+00
   20  00:00:01   1.2889e+01      4          5.8136e+00   5.8136e+00
   30  00:00:02   1.3022e+01      5          6.2945e+00   6.2945e+00
   40  00:00:02   1.4219e+01      6          7.0820e+00   7.0820e+00
   50  00:00:03   1.7959e+01      7  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:03   1.2770e+01      8  EP      5.4622e+00   5.4622e+00
   10  00:00:03   1.2594e+01      9          5.5337e+00   5.5337e+00
   20  00:00:04   1.2432e+01     10          5.7299e+00   5.7299e+00
   28  00:00:05   1.2052e+01     11  FP      5.8412e+00   5.8412e+00
   30  00:00:05   1.1914e+01     12          5.8281e+00   5.8281e+00
   40  00:00:05   1.1034e+01     13          5.4915e+00   5.4915e+00
   47  00:00:06   9.6790e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=34': Continue family of periodic orbits from point 34 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          6.98e-15  1.30e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.3033e+01      1  EP      5.2875e+00   5.2875e+00
    1  00:00:00   1.3033e+01      2  FP      5.2875e+00   5.2875e+00
   10  00:00:00   1.2997e+01      3          5.3734e+00   5.3734e+00
   20  00:00:01   1.3022e+01      4          5.6785e+00   5.6785e+00
   30  00:00:02   1.3026e+01      5          6.2269e+00   6.2269e+00
   40  00:00:02   1.4305e+01      6          7.1168e+00   7.1168e+00
   50  00:00:03   1.7962e+01      7  EP      8.9760e+00   8.9760e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:03   1.3033e+01      8  EP      5.2875e+00   5.2875e+00
   10  00:00:03   1.2806e+01      9          5.3674e+00   5.3674e+00
   20  00:00:04   1.2381e+01     10          5.6081e+00   5.6081e+00
   30  00:00:05   1.1942e+01     11  FP      5.7944e+00   5.7944e+00
   30  00:00:05   1.1906e+01     12          5.7932e+00   5.7932e+00
   40  00:00:05   1.1075e+01     13          5.5065e+00   5.5065e+00
   48  00:00:06   9.6809e+00     14  EP      4.8332e+00   4.8332e+00

 Run='lab=35': Continue family of periodic orbits from point 35 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          1.67e-09  1.34e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.3367e+01      1  EP      5.1217e+00   5.1217e+00
    1  00:00:00   1.3367e+01      2  FP      5.1217e+00   5.1217e+00
   10  00:00:00   1.3085e+01      3          5.2069e+00   5.2069e+00
   20  00:00:01   1.2507e+01      4          5.4809e+00   5.4809e+00
   30  00:00:01   1.1938e+01      5          5.7492e+00   5.7492e+00
   31  00:00:02   1.1870e+01      6  FP      5.7511e+00   5.7511e+00
   40  00:00:02   1.1074e+01      7          5.4969e+00   5.4969e+00
   48  00:00:03   9.6853e+00      8  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:03   1.3367e+01      9  EP      5.1217e+00   5.1217e+00
   10  00:00:03   1.3281e+01     10          5.2118e+00   5.2118e+00
   20  00:00:04   1.3203e+01     11          5.5416e+00   5.5416e+00
   30  00:00:05   1.3033e+01     12          6.1475e+00   6.1475e+00
   40  00:00:05   1.4361e+01     13          7.1372e+00   7.1372e+00
   50  00:00:06   1.7965e+01     14  EP      8.9760e+00   8.9760e+00

 Run='lab=36': Continue family of periodic orbits from point 36 in run 'saddle-node'.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          1.45e-14  1.38e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:00   1.3776e+01      1  EP      4.9657e+00   4.9657e+00
   10  00:00:00   1.3438e+01      2          5.0530e+00   5.0530e+00
   20  00:00:01   1.2990e+01      3          5.3485e+00   5.3485e+00
   30  00:00:01   1.2083e+01      4          5.6946e+00   5.6946e+00
   32  00:00:02   1.1890e+01      5  FP      5.7108e+00   5.7108e+00
   40  00:00:02   1.1054e+01      6          5.4708e+00   5.4708e+00
   48  00:00:03   9.6948e+00      7  EP      4.8332e+00   4.8332e+00

 STEP      TIME        ||U||  LABEL  TYPE     po.period            T
    0  00:00:03   1.3776e+01      8  EP      4.9657e+00   4.9657e+00
    1  00:00:03   1.3776e+01      9  FP      4.9657e+00   4.9657e+00
   10  00:00:03   1.3639e+01     10          5.0572e+00   5.0572e+00
   20  00:00:04   1.3437e+01     11          5.4038e+00   5.4038e+00
   30  00:00:05   1.3223e+01     12          6.0464e+00   6.0464e+00
   40  00:00:05   1.4388e+01     13          7.1335e+00   7.1335e+00
   50  00:00:06   1.7970e+01     14  EP      8.9760e+00   8.9760e+00
</pre><h2 id="13">Free vibrations - backbone</h2><p>In this continuation problem, we seek periodic responses in the absence of excitation. These only exist for zero damping, and constitute a one-dimensional family of orbits parameterized by the orbit period. The encoding includes four monitor functions that evaluate to the problem parameters and the first component of the initial point on the periodic orbit, and the corresponding inactive continuation parameters 'T', 'A', 'd', and 'y0'. Holding 'y0' fixed corresponds to the imposition of a Poincare condition, which results in an overall dimensional deficit of -1. A one-dimensional family of periodic orbits is obtained by releasing 'po.period' and 'd', and allowing these to vary during continuation.</p><pre class="codeinput">t0 = (0:0.01:2*pi)';
x0 = 2e-2*[sin(t0) cos(t0)];
p0 = [2*pi; 0; 0];
prob = coco_prob();
prob = coco_set(prob, <span class="string">'ode'</span>, <span class="string">'autonomous'</span>, false);
prob = coco_set(prob, <span class="string">'po'</span>, <span class="string">'bifus'</span>, <span class="string">'off'</span>);
funcs = {F(<span class="string">''</span>),F(<span class="string">'x'</span>),F(<span class="string">'p'</span>)};
coll_args = [funcs, {t0, x0, {<span class="string">'T'</span> <span class="string">'A'</span> <span class="string">'d'</span>}, p0}];
prob = ode_isol2po(prob, <span class="string">''</span>, coll_args{:});
[data, uidx] = coco_get_func_data(prob, <span class="string">'po.orb.coll'</span>, <span class="string">'data'</span>, <span class="string">'uidx'</span>);
maps = data.coll_seg.maps;
prob = coco_add_pars(prob, <span class="string">'section'</span>, uidx(maps.x0_idx(1)), <span class="string">'y0'</span>);
prob = coco_set(prob, <span class="string">'cont'</span>, <span class="string">'NAdapt'</span>, 1, <span class="string">'PtMX'</span>, [0 100]);
cont_args = {1, {<span class="string">'po.period'</span>  <span class="string">'d'</span>}, [2*pi/1.3 2*pi/0.7]};

fprintf(<span class="string">'\n Run=''%s'': Continue backbone curve of periodic orbits.\n'</span>, <span class="keyword">...</span>
  <span class="string">'backbone'</span>);

coco(prob, <span class="string">'backbone'</span>, [], cont_args{:});
</pre><pre class="codeoutput">
 Run='backbone': Continue backbone curve of periodic orbits.

    STEP   DAMPING               NORMS              COMPUTATION TIMES
  IT SIT     GAMMA     ||d||     ||f||     ||U||   F(x)  DF(x)  SOLVE
   0                          6.44e-05  1.09e+01    0.0    0.0    0.0
   1   1  1.00e+00  3.18e-03  2.63e-08  1.09e+01    0.0    0.0    0.0
   2   1  1.00e+00  1.63e-06  2.11e-14  1.09e+01    0.0    0.0    0.0
   3   1  1.00e+00  2.88e-12  4.95e-17  1.09e+01    0.0    0.0    0.0

 STEP      TIME        ||U||  LABEL  TYPE     po.period            d
    0  00:00:00   1.0883e+01      1  EP      6.2822e+00  -4.7009e-16
   10  00:00:00   1.1138e+01      2          5.6510e+00  -1.1275e-15
   20  00:00:01   1.3949e+01      3  EP      4.8332e+00  -1.8322e-15
</pre><h2 id="14">Graphical representation of stored solutions</h2><pre class="codeinput">figure(1); clf; hold <span class="string">on</span>; grid <span class="string">on</span>; box <span class="string">on</span>
coco_plot_bd(<span class="string">'saddle-node'</span>, <span class="string">'T'</span>, @(T) 2*pi./T, <span class="keyword">...</span>
    <span class="string">'||po.orb.x||_{L_2[0,T]}'</span>)
thm = struct(<span class="string">'ustab'</span>, <span class="string">''</span>, <span class="string">'lspec'</span>, {{<span class="string">'r'</span>, <span class="string">'LineWidth'</span>, 2}});
<span class="keyword">for</span> lab=labs
  coco_plot_bd(thm, sprintf(<span class="string">'lab=%d'</span>, lab), <span class="string">'T'</span>, @(T) 2*pi./T, <span class="keyword">...</span>
    <span class="string">'||po.orb.x||_{L_2[0,T]}'</span>)
<span class="keyword">end</span>
thm = struct(<span class="string">'ustab'</span>, <span class="string">''</span>, <span class="string">'lspec'</span>, {{<span class="string">'b--'</span>, <span class="string">'LineWidth'</span>, 2}});
coco_plot_bd(thm, <span class="string">'backbone'</span>, <span class="string">'po.period'</span>, @(T) 2*pi./T, <span class="keyword">...</span>
    <span class="string">'||po.orb.x||_{L_2[0,T]}'</span>)
axis([0.7 1.3 0 inf]); hold <span class="string">off</span>
</pre><img vspace="5" hspace="5" src="demo_02.png" alt=""> <h2 id="15">Remove path to symcoco</h2><pre class="codeinput">rmpath([pwd(),<span class="string">'/../../toolbox'</span>]); <span class="comment">% path of symcoco routines</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Use of symbolic derivatives  for coco demo bistable
% (see coco demo bistable). The right-hand side for the ODE (the Duffing
% oscillator) was generated in <gen_sym_bistable.html>
%
% $$
%   \frac{\mathrm{d}}{\mathrm{d} t}\vec{x}=\vec{f}(t,\vec{x},\vec{p})
% $$ 
%
% where 
%
% $$
%  \vec{x}=
%   \left[\begin{array}{c}
%     x\\ v
%   \end{array}\right],\quad 
%   \vec{p}=\left[
%   \begin{array}{c}
%     T\\ a\\ \gamma
%   \end{array}\right],\quad
%   \vec{f}=\left[
%   \begin{array}{l}
%     v\\ -\gamma v-x-x^3+a \cos(2 \pi t/T)
%   \end{array}\right]
% $$
%% Load path
clear
addpath([pwd(),'/../../toolbox']); % path of symcoco routines
format compact
%% Extract functions with sco_gen
% After the function file |sym_bistable.m| has been generated, the symbolic
% toolbox is no longer needed. The function file is usually not directly
% called by the user. Instead, one uses the wrapper |sco_gen| to define the
% right-hand side and its partial derivatives.  The input format of the
% right-hand side was set by the 2nd and 3rd arguments of the call to
% |sco_sym2funcs|.
%
% The first line calls |sco_gen| to extract the right-hand side $f$ from
% |sym_bistable|. The empty-string second argument indicates that no
% partial derivatives are requested such that the returned function handle
% |f| is will return the values of $f$. Partial derivatives of $f$ with
% respect to its arguments are generated by giving the name of the argument
% of $f$ with respect to which differentiation should occur as the second
% input. Line 2 demonstrates this, defining $\partial
% f_x(t,x,p)$.
f=sco_gen(@sym_bistable,'');    % define f: y=f(t,x,p)
dfx=sco_gen(@sym_bistable,'x'); % define df/dx: J=df(t,x,p)
%%  Initial run with IVP solver
% This section runs an initial-value problem ODE solver for the Duffing
% oscillator problem using |ode45|.  Line 2 and 3 call the standard Matlab
% function |ode45| to solve the ODE using the constructed |f| as its
% argument (with parameters |p0| as fixed in line 1). 
p0=[2*pi; 0.015; 0.04];         % set initial parameter values
[~,x0]=ode45(@(t,x)f(t,x,p0), [0 20*pi], [0;1]); % Transients, starting at x=[0;1]
[t0,x0]=ode45(@(t,x)f(t,x,p0), [0 2*pi], x0(end,:)'); % Approximate periodic orbit
%% Demonstrate vectorized calls to function and derivatives
% The function |f| may be called with arguments |t| of shape |1xN|, |x| of
% shape |2xN|, |p| of shape |3xN|, returning, for example, in line 1, |f_t|
% of shape |2xN|, where |N| is an arbitrary number, permitting vectorized
% calls to |f|. Line 1 demonstrates this call by evaluating |f| along the
% solution obtained by the IVP solver (note the transposing of the inputs
% |t0| and |x0|).
%
% Inputs format of |dfx| is the same as for |f|, but the output has format
% |2x2xN|, returning the |2x2| partial derivative $\partial_xf$ in the
% arguments. Line 2 below demonstrates a vectorized call to |dfx|
% along the solution, where output |df_t| has shape
% |[2,2,size(x0',2)]|.
%
% The plot shows the position, velocity, force and instantaneous spring
% stiffness, thus extracted.
f_t=f(t0',x0',p0);              % values of f(t,x(t),p) along orbit
dfx_t=dfx(t0',x0',p0);           % values of df/dx(t,x(t),p) along orbit
fprintf('size(f_t)=[%d,%d], ',size(f_t));
fprintf('size(dfx_t)=[%d,%d,%d]\n',size(dfx_t));
clf;plot(t0,x0(:,1),'DisplayName','position');hold on;legend;
plot(t0,x0(:,2),'DisplayName','velocity');
plot(t0,f_t(2,:),'DisplayName','force');
plot(t0,squeeze(dfx_t(2,1,:)),'DisplayName','spring stiffness')
hold off
xlabel('time');
%% Second-order derivatives
% Second order partial derivatives are generated by giving a cell array
% with two names as the second argument of |sco_gen|. The input format of
% the resulting function is the same as for |f|, but, for example for
% |dfxp|$=\partial^2_{x,p}f(t,x,p)$, the output has shape |2x2x3xN|. In
% this example, only one of the mixed second derivatives is non-zero (equal
% |-1|): $\partial_{v,\gamma}f_2$, corresponding to |dfxp_t(2,2,3,:)|. 
dfxp=sco_gen(@sym_bistable,{'x','p'});
dfxp_t=dfxp(t0',x0',p0);
fprintf('size(dfxp_t)=[%d,%d,%d,%d]\n',size(dfxp_t));
df2_vgam=squeeze(dfxp_t(2,2,3,:)).' %#ok<*NOPTS>
%% Scalar arguments
% Outputs of derivatives with respect to inputs that were declared as
% scalar in the call to |sco_sym2funcs| have an output format of reduced
% shape. In this example, the 1st argument of |f|, |'t'|, is of this type.
% This exception accommodates conventions of the COLL toolbox.
dft=sco_gen(@sym_bistable,'t');
dftt=sco_gen(@sym_bistable,{'t','t'});
dftp=sco_gen(@sym_bistable,{'t','p'});
dfxt=sco_gen(@sym_bistable,{'x','t'});
fprintf('size(dft_t)=[%d,%d]\n',size(dft(t0',x0',p0)));
fprintf('size(dftt_t)=[%d,%d]\n',size(dftt(t0',x0',p0)));
fprintf('size(dfxt_t)=[%d,%d,%d]\n',size(dfxt(t0',x0',p0)));
%% Shortcut
% The call to |sco_gen| with only its first input is a shortcut for the
% creating the function in line 2 below. This shortcut makes the notation
% more succinct when a sequence of partial derivatives is passed on as an
% argument to coco constructors. For example, the cell array |funcs|
% collects $f$ and its first partial derivatives wit hrespet to |'x'| and
% |'p'|. This cell array is the argument required for the coco demo
% |bistable|.
F=sco_gen(@sym_bistable);                        % F and F2 are the same
F2=@(varargin)sco_gen(@sym_bistable,varargin{:});% F and F2 are the same
funcs = {F(''),F('x'),F('p')}; %#ok<NASGU>
%% Run of coco demo
% Most of the above parts were only an illustration of using symboilc
% derivatives. The coco demo bistable only needs the outputs of the IVP
% solution and  the definition of the array |funcs|.
% Below is the remainder of the original coco demo bistable. At the
% beginning we repeat the commands needed from above.
%% Define r.h.s. and derivatives, and use IVP solution as initial guess
clear
F=sco_gen(@sym_bistable);       %shortcut for function generator
funcs = {F(''),F('x'),F('p')};  % r.h.s. and partial derivatives
p0=[2*pi; 0.015; 0.04];         % set initial parameter values
[~,x0]=ode45(@(t,x)funcs{1}(t,x,p0),[0 20*pi],[0;1]); % Transients, starting at x=[0;1]
[t0,x0]=ode45(@(t,x)funcs{1}(t,x,p0),[0 2*pi],x0(end,:)'); % Approximate periodic orbit
%% Define coco problem for initial response curve
prob = coco_prob();
prob = coco_set(prob, 'ode', 'autonomous', false);
coll_args = [funcs, {t0, x0, {'T' 'A' 'd'}, p0}];
prob = ode_isol2po(prob, '', coll_args{:});
[data, uidx] = coco_get_func_data(prob, 'po.orb.coll', 'data', 'uidx');
maps = data.coll_seg.maps;
prob = coco_add_glue(prob, 'glue', uidx(maps.T_idx), uidx(maps.p_idx(1)));
prob = po_mult_add(prob, 'po.orb');  % Store Floquet multipliers with bifurcation data
cont_args = {1, {'po.period' 'T'}, [2*pi/1.3 2*pi/0.7]};

fprintf('\n Run=''%s'': Continue primary family of periodic orbits.\n', ...
  'freq_resp');

bd1  = coco(prob, 'freq_resp', [], cont_args{:});

%% Continue curve of saddle-node bifurcations
%
% After imposition of gluing conditions, the continuation problem encoded
% below has a dimensional deficit of -2. A one-dimensional family of
% saddle-node bifurcations of periodic orbits is obtained by releasing
% 'po.period', 'T', and 'A', and allowing these to vary during
% continuation.

labs = coco_bd_labs(bd1, 'SN');

prob = coco_prob();
prob = coco_set(prob, 'coll', 'NTST', 25);
prob = ode_SN2SN(prob, '', 'freq_resp', labs(1));
[data, uidx] = coco_get_func_data(prob, 'po.orb.coll', 'data', 'uidx');
maps = data.coll_seg.maps;
prob = coco_add_glue(prob, 'glue', uidx(maps.T_idx), uidx(maps.p_idx(1)));
prob = coco_set(prob, 'cont', 'NAdapt', 5);
prob = coco_add_event(prob, 'UZ', 'A', 0.01:0.005:0.1);
cont_args = {1, {'po.period' 'T' 'A'}, [2*pi/1.3 2*pi/0.7]};

fprintf(...
  '\n Run=''%s'': Continue saddle-node bifurcations from point %d in run ''%s''.\n', ...
  'saddle-node', labs(1), 'freq_resp');

bd2  = coco(prob, 'saddle-node', [], cont_args{:});

%% Sweep frequency-response curves
%
% For each of a sample of points on the curve of saddle-node bifurcations,
% the continuation problem encoded below has dimensional deficit -1.  A
% one-dimensional family of periodic orbits is obtained by releasing
% 'po.period' and 'T', and allowing these to vary during continuation.

labs  = coco_bd_labs(bd2, 'UZ');

for lab=labs
  prob = coco_prob();
  prob = coco_set(prob, 'ode', 'autonomous', false);
  prob = coco_set(prob, 'po', 'bifus', 'off');
  prob = ode_po2po(prob, '', 'saddle-node', lab);
  [data, uidx] = coco_get_func_data(prob, 'po.orb.coll', 'data', 'uidx');
  maps = data.coll_seg.maps;
  prob = coco_add_glue(prob, 'glue', uidx(maps.T_idx), uidx(maps.p_idx(1)));
  prob = coco_set(prob, 'cont', 'NAdapt', 10);
  cont_args = {1, {'po.period' 'T'}, [2*pi/1.3 2*pi/0.7]};
  
  fprintf(...
  '\n Run=''%s'': Continue family of periodic orbits from point %d in run ''%s''.\n', ...
  sprintf('lab=%d', lab), lab, 'saddle-node');

  coco(prob, sprintf('lab=%d', lab), [], cont_args{:});
end


%% Free vibrations - backbone
%
% In this continuation problem, we seek periodic responses in the absence
% of excitation. These only exist for zero damping, and constitute a
% one-dimensional family of orbits parameterized by the orbit period. The
% encoding includes four monitor functions that evaluate to the problem
% parameters and the first component of the initial point on the periodic
% orbit, and the corresponding inactive continuation parameters 'T', 'A',
% 'd', and 'y0'. Holding 'y0' fixed corresponds to the imposition of a
% Poincare condition, which results in an overall dimensional deficit of
% -1. A one-dimensional family of periodic orbits is obtained by releasing
% 'po.period' and 'd', and allowing these to vary during continuation.

t0 = (0:0.01:2*pi)';
x0 = 2e-2*[sin(t0) cos(t0)];
p0 = [2*pi; 0; 0];
prob = coco_prob();
prob = coco_set(prob, 'ode', 'autonomous', false);
prob = coco_set(prob, 'po', 'bifus', 'off');
funcs = {F(''),F('x'),F('p')};
coll_args = [funcs, {t0, x0, {'T' 'A' 'd'}, p0}];
prob = ode_isol2po(prob, '', coll_args{:});
[data, uidx] = coco_get_func_data(prob, 'po.orb.coll', 'data', 'uidx');
maps = data.coll_seg.maps;
prob = coco_add_pars(prob, 'section', uidx(maps.x0_idx(1)), 'y0');
prob = coco_set(prob, 'cont', 'NAdapt', 1, 'PtMX', [0 100]);
cont_args = {1, {'po.period'  'd'}, [2*pi/1.3 2*pi/0.7]};

fprintf('\n Run=''%s'': Continue backbone curve of periodic orbits.\n', ...
  'backbone');

coco(prob, 'backbone', [], cont_args{:});

%% Graphical representation of stored solutions

figure(1); clf; hold on; grid on; box on
coco_plot_bd('saddle-node', 'T', @(T) 2*pi./T, ...
    '||po.orb.x||_{L_2[0,T]}')
thm = struct('ustab', '', 'lspec', {{'r', 'LineWidth', 2}});
for lab=labs
  coco_plot_bd(thm, sprintf('lab=%d', lab), 'T', @(T) 2*pi./T, ...
    '||po.orb.x||_{L_2[0,T]}')
end
thm = struct('ustab', '', 'lspec', {{'bREPLACE_WITH_DASH_DASH', 'LineWidth', 2}});
coco_plot_bd(thm, 'backbone', 'po.period', @(T) 2*pi./T, ...
    '||po.orb.x||_{L_2[0,T]}')
axis([0.7 1.3 0 inf]); hold off
%% Remove path to symcoco
rmpath([pwd(),'/../../toolbox']); % path of symcoco routines

##### SOURCE END #####
--></body></html>